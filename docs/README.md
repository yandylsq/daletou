# 大乐透预测系统 - 文档总览

## 📚 文档导航

欢迎使用大乐透预测系统！本系统提供完整的号码预测、回测验证、历史查询等功能。

---

## 📖 文档清单

### 1. [系统功能模块说明书](./SYSTEM_MODULES.md)
**适合人群**：产品经理、业务人员、新开发者

**内容概要**：
- ✅ 系统概述与技术特点
- ✅ 核心功能模块详解（预测、回测、网页分析、历史管理、模型训练）
- ✅ 过滤条件体系（前置过滤、用户过滤、回测过滤）
- ✅ 评分系统详解（基础统计、历史特征、机器学习、网页参考）
- ✅ 模块交互关系与数据流图

**何时查阅**：
- 了解系统有哪些功能
- 理解各功能模块的职责
- 查询过滤条件的具体规则
- 了解评分系统的工作原理

---

### 2. [系统设计文档](./DESIGN_DOCUMENT.md)
**适合人群**：架构师、高级开发者、技术决策者

**内容概要**：
- ✅ 系统总体架构（前端层、API层、业务层、ML层、数据层）
- ✅ 技术选型说明（Flask、scikit-learn、PyTorch、NetworkX等）
- ✅ 核心算法设计（全量枚举、多维评分、多样性过滤、确定性保证）
- ✅ 数据流程完整链路
- ✅ 性能优化策略（缓存、批量化、边枚举边过滤、流式输出）
- ✅ 安全性设计（输入验证、异常降级、任务中止）

**何时查阅**：
- 进行架构设计或重构
- 理解核心算法实现原理
- 进行性能优化
- 排查复杂技术问题

---

### 3. [API接口文档](./API_REFERENCE.md)
**适合人群**：前端开发者、接口调用方、测试人员

**内容概要**：
- ✅ 接口概述与基础信息
- ✅ 预测接口详细说明（参数、响应、SSE流式输出）
- ✅ 回测接口详细说明（参数、响应、统计指标）
- ✅ 历史查询接口
- ✅ 任务取消接口
- ✅ 错误码定义与处理
- ✅ 完整调用示例（JavaScript + EventSource）

**何时查阅**：
- 前端对接后端接口
- 编写接口调用代码
- 调试接口问题
- 了解错误码含义

---

### 4. [开发规范文档](./DEVELOPMENT_GUIDE.md)
**适合人群**：所有开发者、代码审查者

**内容概要**：
- ✅ Python编码规范（PEP 8、命名规范、注释规范）
- ✅ 禁止使用中文标点符号（关键规范）
- ✅ 异常处理与日志规范
- ✅ 过滤条件规范（前置过滤、用户过滤、优先级）
- ✅ 测试规范（单元测试、集成测试、性能测试）
- ✅ Git规范（分支管理、Commit规范）
- ✅ 文档规范

**何时查阅**：
- 编写新代码前
- 进行代码审查
- 添加新过滤条件
- 编写测试用例
- 提交代码前

---

### 5. [文档更新检查清单](./DOCS_UPDATE_CHECKLIST.md)
**适合人群**：所有开发者

**内容概要**：
- ✅ 强制性更新要求
- ✅ 详细更新清单（README、版本说明、设计文档、API文档等）
- ✅ 更新触发条件（算法优化、功能变更、代码重构等）
- ✅ 更新模板和示例
- ✅ 常见遗漏项
- ✅ 文档质量标准

**何时查阅**：
- 代码修改后
- 功能优化后
- 模型调整后
- 提交代码前

---

### 6. [版本说明文档](./VERSION_NOTES/)
**适合人群**：所有人

**包含版本**：
- [V12 均衡优化版](./VERSION_NOTES/V12_BALANCED_OPTIMIZATION.md)
- [V11 激进优化版](./VERSION_NOTES/V11_OPTIMIZATION_NOTES.md)
- [V10 确定性修复](./VERSION_NOTES/V10_DETERMINISM_FIX.md)
- [V10 实现总结](./VERSION_NOTES/V10_IMPLEMENTATION_SUMMARY.md)
- [V9 升级说明](./VERSION_NOTES/V9_UPGRADE_NOTES.md)

**何时查阅**：
- 了解版本更新内容
- 查看算法优化详情
- 追踪功能变更历史
- Bug修复记录

---

## 🚀 快速开始

### 1. 环境准备

```bash
# 克隆项目
git clone <repository_url>
cd daletou

# 创建虚拟环境
python -m venv .venv

# 激活虚拟环境（Windows）
.venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt
```

### 2. 启动系统

```bash
# 启动Flask服务
python app.py

# 访问地址
http://localhost:5000
```

### 3. 调用示例

```javascript
// 发起预测请求
fetch('/api/predict', {
  method: 'POST',
  headers: {'Content-Type': 'application/json'},
  body: JSON.stringify({
    period: '26009',
    kill_red: [1, 2, 35],
    sum_range: [80, 120]
  })
})
.then(response => {
  // 处理SSE流式响应
  const reader = response.body.getReader();
  // ...
});
```

---

## 📊 系统架构一览

```
┌─────────────────────────────────────────────────────────┐
│                    前端层 (Frontend)                     │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌─────────┐ │
│  │ 预测界面 │  │ 回测界面 │  │ 历史查询 │  │ 导出功能 │ │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬────┘ │
└───────┼─────────────┼─────────────┼─────────────┼──────┘
        │             │             │             │
        └─────────────┴─────────────┴─────────────┘
                         │ HTTP/SSE
┌────────────────────────┼─────────────────────────────────┐
│                 API 网关层 (Flask)                       │
│  ┌─────────────────────┴─────────────────────┐          │
│  │     app.py (路由控制 + SSE 流式响应)      │          │
│  └─────────────────────┬─────────────────────┘          │
└────────────────────────┼─────────────────────────────────┘
                         │
┌────────────────────────┼─────────────────────────────────┐
│                   业务逻辑层 (Business)                  │
│  ┌──────────────────┐  ┌──────────────────┐             │
│  │ DaletouPredictor │  │  ModelEngine     │             │
│  │   (预测引擎)     │  │  (模型管理)      │             │
│  └────────┬─────────┘  └────────┬─────────┘             │
│           │                     │                        │
│  ┌────────┴─────────────────────┴─────────┐             │
│  │      号码生成 + 评分 + 过滤逻辑        │             │
│  └────────────────────┬───────────────────┘             │
└───────────────────────┼──────────────────────────────────┘
                        │
┌───────────────────────┼──────────────────────────────────┐
│                 机器学习层 (ML)                          │
│  ┌────────────────┐  ┌────────────┐  ┌────────────┐     │
│  │ Stacking Model │  │ LSTM Model │  │ Graph Model│     │
│  │   (集成学习)   │  │  (时序)    │  │  (网络)    │     │
│  └────────────────┘  └────────────┘  └────────────┘     │
└───────────────────────┼──────────────────────────────────┘
                        │
┌───────────────────────┼──────────────────────────────────┐
│                   数据层 (Data)                          │
│  ┌─────────────────┐  ┌─────────────────┐               │
│  │ 历史开奖数据    │  │  模型缓存文件   │               │
│  │ .txt / .csv     │  │  .pkl / .json   │               │
│  └─────────────────┘  └─────────────────┘               │
└──────────────────────────────────────────────────────────┘
```

---

## 🔑 关键概念速查

### 前置过滤条件
**定义**：在预测/导出模式下强制应用的基础过滤规则

**包含条件**：
1. 历史开奖号码（完全相同）
2. 四连号（≥4个连续）
3. 等差数列（公差相同）
4. 等比数列（比值相同）
5. 全奇/全偶
6. 同区号码（1-11、12-23、24-35）

**应用场景**：预测、导出（`is_backtest=False`）

**不应用场景**：回测验证（`is_backtest=True`）

---

### 用户自定义过滤
**定义**：用户手动输入的过滤条件

**包含条件**：
- 杀号（kill_red, kill_blue）
- 和值范围（sum_range）
- 奇偶比（odd_even_ratio）
- 重号约束（前区≥3、后区≥2）
- 蓝球大小号约束

**应用场景**：预测、导出（`is_backtest=False`）

**不应用场景**：回测验证（`is_backtest=True`）

---

### 多维评分体系
**评分维度**：
```
最终得分 = 基础得分 × 红球加成 × 蓝球加成 × 网页加成
           (100-500)  (×1.0-4.25) (×1.0-3.0) (×1.0-1.5)
```

**基础得分因素**：
- 和值区间、奇偶比、跨度
- 连号惩罚、AC值、012路平衡
- 质数分布、重号策略、冷热号

**模型加成**：
- Stacking 模型置信度
- LSTM 时序预测
- 号码共现网络

---

## ❓ 常见问题

### Q1: 为什么回测不应用过滤条件？
**A**: 回测的目的是模拟真实预测场景，评估模型在无任何人为干预下的准确率。如果应用用户过滤条件，会导致回测结果失真。

### Q2: 前置过滤和用户过滤有什么区别？
**A**: 
- **前置过滤**：系统强制规则，基于统计学规律（如历史上几乎不会出现全奇号码）
- **用户过滤**：用户个性化选择，可选择性应用

### Q3: 为什么预测结果每次都一样？
**A**: 系统基于期号设置随机种子（`np.random.seed(period)`），确保算法确定性，相同输入产生相同输出。

### Q4: 如何提高预测准确率？
**A**: 
1. 增加历史数据量
2. 优化特征工程
3. 调整评分权重
4. 引入更多参考网页

### Q5: 中文标点符号为什么会报错？
**A**: Python 语法只识别英文标点（`,` `:` `;` 等），中文标点（`，` `：` `；`）会导致 `SyntaxError`。

---

## 📞 技术支持

### 问题反馈
- **GitHub Issues**: <repository_url>/issues
- **邮箱**: support@example.com

### 贡献指南
1. Fork 项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'feat: Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

---

## 📅 版本历史

| 版本 | 日期 | 主要更新 |
|------|------|----------|
| V12.0 | 2026-01-29 | 均衡优化：解决小号缺失，性能提升200倍，智能采样策略 |
| V11.0 | 2026-01-27 | 激进优化：评分系统重构，过滤条件放宽，特征工程增强 |
| V10.0 | 2026-01-25 | 确定性修复，模块独立性优化，历史数据统一 |
| V9.0 | 2026-01-22 | 功能升级，完善回测机制，优化评分算法 |
| V1.0 | 2026-01-21 | 初始版本，完整文档体系 |
| V0.9 | 2026-01-15 | Beta版本，核心功能实现 |
| V0.5 | 2026-01-01 | Alpha版本，原型开发 |

---

## 📜 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](../LICENSE) 文件

---

**文档最后更新**: 2026-01-29  
**维护者**: AI Assistant  
**版本**: V12.0

---

## 🌟 感谢使用！

如有任何问题或建议，欢迎随时联系我们。祝您使用愉快！🎉
